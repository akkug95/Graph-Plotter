<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Question 3</title>

	</head>
	<body>
<script src="charts.js"></script>
<script src="export.js"></script>

<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto">

<input type="file" id="selectFiles" value="Import" /><br />
<button id="import">Import</button>


</div>



<script type="text/javascript">

    document.getElementById('import').onclick = function() { 
    var files = document.getElementById('selectFiles').files;// getting json file
  console.log(files);
  if (files.length <= 0) {
    return false;
  }

  var fr = new FileReader();

  fr.onload = function(e) { 
  console.log(e);
    var obj = JSON.parse(e.target.result); // json file is parsed

  var g = obj["groups"];	// g is the list of groups
  var i,j,k,di=0;
  var dat = [];
  for(i=0;i< g.length ;i++){
	var gi= g[i]["peaks"];
	var rt = [];
	var it = [];
	
	for(j=0;j< gi.length; j++,di++){
		rt[j]= [];
		it[j]= [];
		
		dat[di]=[];

		rt[j] =gi[j]["eic"]["rt"];
		it[j] =gi[j]["eic"]["intensity"];
		
		for(k=0;k<rt[j].length;k++){
			dat[di].push([rt[j][k],it[j][k]]);	// storing ('rt','intensity') pair of each sample in dat[] 
		}
	}
  }
	
	var sr= [],di=0;
	for(i=0; i< g.length; i++){
		gi= g[i]["peaks"];
		for(j=0;j< gi.length;j++){
			sr.push({
				"name": gi[j]["sampleName"],
				"data":	dat[di++],
				"type": 'areaspline'
			});						// sr[] is the list of all samples
		}
	}

	//plotting graph
	
	Highcharts.chart('container', {
			chart: {
				type: 'areaspline'
			},
			title: {
				text: ' Graph Plotter '
			},
			legend: {
				layout: 'vertical',
				align: 'left',
				verticalAlign: 'top',
				x: 150,
				y: 150,
				floating: true,
				borderWidth: 1,
				backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
			},
			xAxis: {
				title: {
					text: ' Retention Time '
				}
			},
			yAxis: {
				title: {
					text: ' Intensity '
				}
			},
			tooltip: {
				shared: true,
				valueSuffix: ' units '
			},
			credits: {
				enabled: false
			},
			plotOptions: {
				areaspline: {
					fillOpacity: 0.5
				}
			},
			series: sr		
			
		});


		
		
  }

  fr.readAsText(files.item(0));
};		

		</script>
	</body>
</html>
